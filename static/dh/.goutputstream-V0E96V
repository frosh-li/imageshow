
(function(){
    var dh = function(){
    	  this.mainContainer = null;
   	  this.pickBtn = null;
           };
   dh.setFloatStyle=function(obj,style) 
	{
	   var sty=obj.style;  
	   if('cssFloat' in sty){  
	      obj.style.cssFloat=style;  
	   }else if('styleFloat' in sty){  
	      obj.style.styleFloat=style;  
	   }else{  
	      throw 'set float style:'+style+'error.';  
	   }  
	}
    dh.prototype = {
			init:function(){
				this.drawPanel();
			},
			drawPanel:function(){

				var newElement = document.createElement("div");
				newElement.id="dh_pick_img";
				newElement.setAttribute("style","position:fixed;width:160px;right:0px;top:0px;overflow-x:hidden;overflow-y:scroll;margin:0px;padding:10px;border:1px solid #ccc;z-index:999999;");
				newElement.innerHTML = '<div style="text-align: center;"><span id="_obj_dh_pick_btn_" style="color: rgb(102, 102, 102); font-size: 14px; display:inline-block; text-shadow: rgba(0, 0, 0, 0.292969) 0px 1px 1px; border-top-left-radius: 0.5em 0.5em; border-top-right-radius: 0.5em 0.5em; border-bottom-right-radius: 0.5em 0.5em; border-bottom-left-radius: 0.5em 0.5em; padding-top: 0.5em; padding-right: 2em; padding-bottom: 0.55em; padding-left: 2em; -webkit-box-shadow: rgba(0, 0, 0, 0.199219) 0px 1px 2px; box-shadow: rgb(48, 27, 41) 3px 2px 31px; background-color: white; cursor: pointer; position: relative; top: 0px; opacity: 0.9; " onmouseover="this.style.opacity=1;" onmouseout="this.style.opacity=0.9" onmousedown="this.style.top=\'1px\'" onmouseup="this.style.top=\'0px\'">'+"\u6293\u53d6\u672c\u9875\u56fe\u7247"+'</span><span id="_obj_dh_save_btn_" style="color: rgb(102, 102, 102); margin-left:10px;font-size: 14px; display:none; text-shadow: rgba(0, 0, 0, 0.292969) 0px 1px 1px; border-top-left-radius: 0.5em 0.5em; border-top-right-radius: 0.5em 0.5em; border-bottom-right-radius: 0.5em 0.5em; border-bottom-left-radius: 0.5em 0.5em; padding-top: 0.5em; padding-right: 2em; padding-bottom: 0.55em; padding-left: 2em; -webkit-box-shadow: rgba(0, 0, 0, 0.199219) 0px 1px 2px; box-shadow: rgb(48, 27, 41) 3px 2px 31px; background-color: white; cursor: pointer; position: relative;margin-top:15px; top: 0px; opacity: 0.9; " onmouseover="this.style.opacity=1;" onmouseout="this.style.opacity=0.9" onmousedown="this.style.top=\'1px\'" onmouseup="this.style.top=\'0px\'">'+"\u4e0a\u4f20"+'</span><span id="_obj_dh_max_btn_" style="color: rgb(102, 102, 102); font-size: 14px; display:none;margin-left:10px; text-shadow: rgba(0, 0, 0, 0.292969) 0px 1px 1px; border-top-left-radius: 0.5em 0.5em; border-top-right-radius: 0.5em 0.5em; border-bottom-right-radius: 0.5em 0.5em; border-bottom-left-radius: 0.5em 0.5em; padding-top: 0.5em; padding-right: 2em; padding-bottom: 0.55em; padding-left: 2em; -webkit-box-shadow: rgba(0, 0, 0, 0.199219) 0px 1px 2px; box-shadow: rgb(48, 27, 41) 3px 2px 31px; background-color: white; cursor: pointer; position: relative;margin-top:15px; top: 0px; opacity: 0.9; " onmouseover="this.style.opacity=1;" onmouseout="this.style.opacity=0.9" onmousedown="this.style.top=\'1px\'" onmouseup="this.style.top=\'0px\'">'+"MAX Size"+'</span></div><div id="_obj_dh_picked_images_list" style="padding:10px;display:none;color:white;"></div>';
				//TODO page element
				var me = this;
				document.body.appendChild(newElement);
				this.mainContainer = newElement;
				this.pickBtn = document.getElementById("_obj_dh_pick_btn_");
				document.getElementById("_obj_dh_max_btn_").onclick = function(){
					// min window
					var mainContain = document.getElementById("dh_pick_img");
					mainContain.style.width = "160px";
					mainContain.style.height = "auto";
					var mask = document.getElementById("_dh_div_mask_");
					document.body.removeChild(mask); 
					document.getElementById("_obj_dh_max_btn_").style.display = "none";
					document.getElementById("_obj_dh_save_btn_").style.display = "none";
					document.getElementById("_obj_dh_picked_images_list").style.display = "none";
					document.getElementById("_obj_dh_pick_btn_").style.display = "inline-block";
					
				};
				this.pickBtn.onclick = function(){me.startToPick(me)};
			},
			getPageHeight:function() {
			 
     			 return document.documentElement.offsetHeight;
			},
			startToPick:function(me){
				var tpl = "<img src='${src}' style='width:80px;' /><span>${title}</span><em>size:${size}</em>";
				var allimages = document.getElementsByTagName("img"),
					 pageTitle = document.getElementsByTagName("title")[0].innerHTML,
					 htmlCode = [],
					 aData = [];
				var targetElement = document.getElementById("_obj_dh_picked_images_list");
				targetElement.innerHTML = "";
				console.log(allimages.length);
				for(var i = 0 ; i < allimages.length ; i++){
					var cImg = allimages[i];
					if(parseInt(cImg.width) < 300){
						continue;
					}
					var cAlt = cImg.getAttribute("alt"),
					 	 cTitle = cImg.getAttribute("title"),
					 	 cSrc = cImg.getAttribute("src"),
					 	 size = cImg.width + "*" + cImg.height;
						 rTitle = cAlt!="" && cAlt != null?cAlt:(cTitle!="" && cTitle != null?cTitle:"